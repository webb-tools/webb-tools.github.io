
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://docs.webb.tools/shielded-pool-protocols/tornado-pool/overview/">
      
      <link rel="icon" href="../../../img/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.6">
    
    
      
        <title>Overview - Webb Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.a57b2b03.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#ffffff">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="white" data-md-color-accent="blue">
  
    
    <script>function __prefix(e){return new URL("../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#basics-of-tornado-pool" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Webb Docs" class="md-header__button md-logo" aria-label="Webb Docs" data-md-component="logo">
      
  <img src="../../../img/webb-icon.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Webb Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Overview
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Webb Docs" class="md-nav__button md-logo" aria-label="Webb Docs" data-md-component="logo">
      
  <img src="../../../img/webb-icon.svg" alt="logo">

    </a>
    Webb Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Bridge protocols
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Bridge protocols" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Bridge protocols
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1">
          Webb Protocol
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Webb Protocol" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          Webb Protocol
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../bridge-protocols/webb/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../bridge-protocols/webb/architecture/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../bridge-protocols/webb/technical-roadmap/" class="md-nav__link">
        Technical Roadmap
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../bridge-protocols/webb/governance/" class="md-nav__link">
        Governance
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1_5" type="checkbox" id="__nav_2_1_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1_5">
          Implementations
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Implementations" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_1_5">
          <span class="md-nav__icon md-icon"></span>
          Implementations
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1_5_1" type="checkbox" id="__nav_2_1_5_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1_5_1">
          Solidity
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Solidity" data-md-level="4">
        <label class="md-nav__title" for="__nav_2_1_5_1">
          <span class="md-nav__icon md-icon"></span>
          Solidity
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../bridge-protocols/webb/contracts/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1_5_1_2" type="checkbox" id="__nav_2_1_5_1_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1_5_1_2">
          Contracts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Contracts" data-md-level="5">
        <label class="md-nav__title" for="__nav_2_1_5_1_2">
          <span class="md-nav__icon md-icon"></span>
          Contracts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../bridge-protocols/webb/contracts/Anchor/" class="md-nav__link">
        Anchor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../bridge-protocols/webb/contracts/AnchorBase/" class="md-nav__link">
        AnchorBase
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../bridge-protocols/webb/contracts/LinkableAnchor/" class="md-nav__link">
        LinkableAnchor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../bridge-protocols/webb/contracts/MerkleTreeWithHistoryPoseidon/" class="md-nav__link">
        MerkleTreeWithHistoryPoseidon
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1_5_2" type="checkbox" id="__nav_2_1_5_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1_5_2">
          Substrate
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Substrate" data-md-level="4">
        <label class="md-nav__title" for="__nav_2_1_5_2">
          <span class="md-nav__icon md-icon"></span>
          Substrate
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../bridge-protocols/webb/pallets/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../bridge-protocols/webb/pallets/overview/" class="md-nav__link">
        Pallets
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../bridge-protocols/webb/deployments/" class="md-nav__link">
        Deployments
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Mixer protocols
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Mixer protocols" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Mixer protocols
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1">
          Tornado Core (webb version)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tornado Core (webb version)" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Tornado Core (webb version)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../mixer-protocols/tornado/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../mixer-protocols/tornado/deployments/" class="md-nav__link">
        Deployments
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_3" type="checkbox" id="__nav_3_1_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1_3">
          Contracts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Contracts" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_1_3">
          <span class="md-nav__icon md-icon"></span>
          Contracts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../mixer-protocols/tornado/contracts/Anchor/" class="md-nav__link">
        Anchor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../mixer-protocols/tornado/contracts/IHasher/" class="md-nav__link">
        IHasher
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../mixer-protocols/tornado/contracts/IVerifier/" class="md-nav__link">
        IVerifier
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../mixer-protocols/tornado/contracts/MerkleTreeWithHistory/" class="md-nav__link">
        MerkleTreeWithHistory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../mixer-protocols/tornado/contracts/NativeAnchor/" class="md-nav__link">
        NativeAnchor
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Shielded Pool protocols
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Shielded Pool protocols" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Shielded Pool protocols
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1" type="checkbox" id="__nav_4_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4_1">
          Tornado Pool
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tornado Pool" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          Tornado Pool
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Overview
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Overview
      </a>
      
        


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#utxo-model" class="md-nav__link">
    UTXO Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exact-utxo-structure" class="md-nav__link">
    Exact UTXO Structure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preventing-double-spending-via-nullifiers" class="md-nav__link">
    Preventing Double Spending via Nullifiers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transaction-proof" class="md-nav__link">
    Transaction Proof
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extamount-fees-and-privacy-relayers" class="md-nav__link">
    extamount, fees, and Privacy Relayers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Relayer
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Relayer" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Relayer
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../relayer/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../relayer/setup/" class="md-nav__link">
        Setup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../relayer/http-endpoints/" class="md-nav__link">
        Http Endpoints
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../relayer/websockets/" class="md-nav__link">
        WebSockets
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../repos/overview/" class="md-nav__link">
        Organisation Repos
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#utxo-model" class="md-nav__link">
    UTXO Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exact-utxo-structure" class="md-nav__link">
    Exact UTXO Structure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preventing-double-spending-via-nullifiers" class="md-nav__link">
    Preventing Double Spending via Nullifiers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transaction-proof" class="md-nav__link">
    Transaction Proof
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extamount-fees-and-privacy-relayers" class="md-nav__link">
    extamount, fees, and Privacy Relayers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="basics-of-tornado-pool">Basics of Tornado Pool<a class="headerlink" href="#basics-of-tornado-pool" title="Permanent link">&para;</a></h1>
<p>Tornado Pool allows for users to deposit and withdraw arbitrary amounts. It also allows users to do a shielded transfer to another user inside the pool.</p>
<h3 id="utxo-model">UTXO Model<a class="headerlink" href="#utxo-model" title="Permanent link">&para;</a></h3>
<p>The project utilizes the UTXO (unspent transaction output) model to handle users' funds, so we first review it.</p>
<p>(partially copied from Wikipedia)</p>
<p>The total UTXOs present in the Tornado Pool represents a set (which we call the UTXO set). Every transaction consumes elements from this set and creates new ones that are added to the set. Thus, the set represents all of the funds in the Tornado Pool. </p>
<p>put exact structure here</p>
<p>Let's first see how different actions affect the total size of the UTXO set of the Tornado Pool.</p>
<p><em>Depositing into the Pool:</em> This increases the amount of funds in the UTXO set by the deposit amount.</p>
<p><em>Withdrawing from the Pool:</em> This decreases the amount of funds in the UTXO set by the withdrawal amount.</p>
<p><em>Shielded Transaction to Another User:</em> This keeps the amount of funds in the UTXO set the same.</p>
<p>We define the <code>inputUTXOs</code>to be the elements from the UTXO set that are spent during a transaction. We define the <code>outputUTXOs</code> to be the elements of the UTXO set that are created during a transaction. If there are no funds being deposited or withdrawn from the Tornado Pool, we have the following invariant for any transaction:  <code>sum of inputUTXOs = sum of outputUTXOs</code>. </p>
<p>Suppose  <code>publicAmount</code> is being deposited or withdrawn from the pool. Then, for any transaction we have the following invariant  <code>sum of inputUTXOs + publicAmount = sum of outputUTXOs</code>.  </p>
<p>Let's do an example with numbers:</p>
<p>Initially the UTXO set = {} (is empty).</p>
<ol>
<li>Alice deposits 8 ETH into pool. <ol>
<li><code>inputUTXOs</code> = {0 ETH}</li>
<li><code>publicAmount</code> = 8 ETH</li>
<li><code>outputUTXOs</code> = {8 ETH}</li>
<li>UTXO Set = {8 ETH} </li>
</ol>
</li>
<li>Alice deposits 9 ETH into pool. UTXO Set = {8 ETH, 9 ETH}<ol>
<li><code>inputUTXOs</code> = {0 ETH}</li>
<li><code>publicAmount</code> = 9 ETH</li>
<li><code>outputUTXOs</code> = {9 ETH}</li>
<li>UTXO Set = {8 ETH, 9 ETH} </li>
</ol>
</li>
<li>Alice withdraws 11 ETH from pool. <ol>
<li><code>inputUTXOs</code> = {8 ETH, 9 ETH} </li>
<li><code>publicAmount</code> = -11 ETH</li>
<li><code>outputUTXOs</code> = {6 ETH}</li>
<li>UTXO Set = {6 ETH}</li>
</ol>
</li>
<li>Bob deposits 1 ETH into pool.<ol>
<li><code>inputUTXOs</code> = {0 ETH} </li>
<li><code>publicAmount</code> = 1 ETH</li>
<li><code>outputUTXOs</code> = {1 ETH}</li>
<li>UTXO Set = {6 ETH}</li>
</ol>
</li>
<li>Alice transfers 3 ETH to Bob.<ol>
<li><code>inputUTXOs</code> = {6 ETH} </li>
<li><code>publicAmount</code> = 0 ETH</li>
<li><code>outputUTXOs</code> = {3 ETH, 3 ETH}</li>
<li>UTXO Set = {3 ETH, 3 ETH, 1 ETH}</li>
</ol>
</li>
</ol>
<p>Notice that the invariant <code>sum of inputUTXOs + publicAmount = sum of outputUTXOs</code> holds in each of the steps. Since this invariant covers depositing and withdrawing, we do not need separate functions for each but rather a single <code>transact</code> function which takes care of both depositing and withdrawing. When Alice calls the <code>transact</code> function on the Tornado Pool contract she will submit a proof that (amongst other things) the invariant holds for her proposed transaction.</p>
<h3 id="exact-utxo-structure">Exact UTXO Structure<a class="headerlink" href="#exact-utxo-structure" title="Permanent link">&para;</a></h3>
<p>Although in the examples in the previous section we represented a UTXO by its <code>amount</code>, the exact structure of a UTXO in Tornado Pool is more complex. In Tornado Pool, a UTXO is a triplet<code>{amount, publicKey, blinding}</code>and the commitiment that gets added to the Merkle tree maintained by the Tornado Pool is <code>Poseidon(amount, publicKey, blinding)</code>. The blinding is a random number, like the secret in the original Tornado cash. The public key corresponds to the owner of the UTXO and when transact is called, it is checked that only the person with the corresponding private key can spend the input (more on exactly how this happens in a later section). The private key and public key are related by: <code>publicKey = Poseidon(privateKey)</code>. </p>
<h3 id="preventing-double-spending-via-nullifiers">Preventing Double Spending via Nullifiers<a class="headerlink" href="#preventing-double-spending-via-nullifiers" title="Permanent link">&para;</a></h3>
<p>What prevents Alice from spending the same UTXO twice?</p>
<p>Tornado Pool has a nullifier corresponding to every UTXO. When a UTXO is spent, the corresponding nullifier is recorded on the Tornado Pool smart contract, which prevents the same UTXO from being spent again. The structure of the nullifier is <code>Poseidon(commitment, merklePath, privateKey)</code>. Note this structure implies that the nullifier of each UTXO is unique.</p>
<h3 id="transaction-proof">Transaction Proof<a class="headerlink" href="#transaction-proof" title="Permanent link">&para;</a></h3>
<p>When Alice submits calls the <code>transact</code> function on the smart contract, she needs to prove the following things (there are few other things she needs to show, but we omit them for now) about her transaction:</p>
<ol>
<li>The <code>inputUTXOs</code> she wants to spend actually exist</li>
<li>She owns the <code>inputUTXOs</code> that she wants to spend. </li>
<li>The <code>inputUTXOs</code> that she wants to spend have not already been spent.</li>
<li>The invariant <code>sum of inputUTXOs + publicAmount = sum of outputUTXOs</code> holds.</li>
</ol>
<p>She needs to do this while keeping certain information private. Therefore, like in the original Tornado Cash, Alice uses zero-knowledge proofs to convince the smart contract that she is submitting a valid transaction. To do so, we construct a <code>Transaction(levels, nIns, nOuts, zeroLeaf)</code> circuit, such that the constraints of this circuit are satisfied if and only if Alice submits a valid transaction. <code>levels</code> is the number of levels in the Tornado Pool Merkle tree, <code>nIns</code> is the number of <code>inputUTXOs</code> being spent, <code>nOuts</code> is the number of <code>outputUTXOs</code> being created, and <code>zeroLeaf</code> is <code>Poseidon(0, 0)</code>.</p>
<p>The private inputs to the <code>Transaction</code> circuit are:</p>
<ol>
<li><code>inAmount[nIns]</code> , the amount for each of the <code>inputUTXOs</code></li>
<li><code>inPrivateKey[nIns]</code>, the private key for each of the <code>inputUTXOs</code></li>
<li><code>inBlinding[nIns]</code>, the blinding for each of the <code>inputUTXOs</code></li>
<li><code>inPathIndices[nIns]</code>, a binary string that indicates whether the corresponding <code>pathElement</code> element is on the left or right side of the Merkle tree for each <code>inputUTXO</code></li>
<li><code>inPathElements[nIns][levels]</code> an array of the Merkle proof elements for each <code>inputUTXO</code></li>
<li><code>outAmount[nOuts]</code>, the amount of each of the <code>outputUTXOs</code></li>
<li><code>outPubKey[nOuts]</code>, the public key of each of the <code>outputUTXOs</code></li>
<li><code>outBlinding[nOuts]</code>, the blinding of each of the <code>outputUTXOs</code></li>
</ol>
<p>The public inputs to the <code>Transaction</code> circuit are:</p>
<ol>
<li><code>root</code> the root of the Tornado Pool Merkle tree </li>
<li><code>publicAmount</code>, explained in detail in the section below</li>
<li><code>extDataHash</code>, hash of <code>extData</code>(which contains information like the <code>recipient</code>, <code>relayer</code> and <code>fee</code>)..not used in any computations, so we will ignore discussing it.</li>
<li><code>inputNullifier[nIns]</code>, the nullifier corresponding to each of the <code>inputUTXOs</code></li>
<li><code>outputCommitment[nOuts]</code>, the commitment of each of the <code>outputUTXOs</code></li>
</ol>
<p>The <code>Transaction</code> circuit works as follows:</p>
<ol>
<li>For each <code>inputUTXO</code>:<ol>
<li>The public key is calculated from the private key using a <code>KeyPair()</code> gadget.</li>
<li>The commitment is calculated from the amount, public key and blinding. </li>
<li>A <code>MerkleProof(levels)</code> gadget is used to check whether the commitment exists in the Tornado Pool Merkle tree</li>
<li>The above three steps show that the <code>inputUTXOs</code> that Alice wants to spend exist and are owned by her.</li>
<li>It is also checked that the nullifiers are correctly computed. This is so that Alice doesn't submit a bogus <code>inputNullifier[nIns]</code> array and then double spend the <code>inputUTXOs</code>.</li>
</ol>
</li>
<li>For each <code>outputUTXO</code>:<ol>
<li>It's checked that the output commitments are correctly computed.</li>
</ol>
</li>
<li>It's also checked that there are no two input nullifiers which are the same. This prevents double spending the same <code>inputUTXO</code> within a single <code>transact</code> call.</li>
<li>The invariant <code>sumIns = publicAmount + sumOuts</code> is checked where <code>sumIns</code> is the sum of the elements in <code>inAmount[nIns]</code>and <code>sumOuts</code> is the sum of the elements in <code>outAmount[nOuts]</code>.</li>
</ol>
<p>The individual gadgets are explained in more detail here:</p>
<p><a href="../circuits/merkleProof/">merkleProof.circom</a></p>
<p><a href="../circuits/keypair/">keypair.circom</a></p>
<h3 id="extamount-fees-and-privacy-relayers">extamount, fees, and Privacy Relayers<a class="headerlink" href="#extamount-fees-and-privacy-relayers" title="Permanent link">&para;</a></h3>
<p>Similar to Tornado Cash, to add more privacy, relayers are used to execute the transactions. These relayers take fees. The <code>publicAmount</code> is the amount actually transferred to/from the Tornado Pool during a <code>transact</code>. Due to relayer fees, this differs from the amount of funds a user must send during a deposit/shielded transfer or the amount the user actually receives during a withdraw transact: this amount is known as <code>extAmount</code>.</p>
<p>The <code>publicAmount</code> is derived from <code>extAmount</code> via the formula: <code>publicAmount = extAmount - fee</code>. To see why this makes sense lets look at a concrete example where <code>fee = 5 ETH</code>. There are three cases for the three types of transactions (although recall that all of them are encompassed by the single function <code>transact</code>):</p>
<ol>
<li>Deposit Transact: Say we want to deposit 10 into the Tornado Pool. We really have to send 15 ETH since 5 ETH is taken by the relayer. So <code>15 ETH = extamount = 10 ETH + 5 ETH = publicAmount + fee</code>.</li>
<li>Shielded Transfer: The <code>publicAmount</code> is 0 ETH, but we really have to send 5 ETH to pay the relayer. We have: <code>0 ETH = publicAmount = 5 ETH - 5 ETH = extAmount - fee</code>.</li>
<li>Withdraw Transact: Say you want to withdraw 10 ETH, you really have to withdraw 15 ETH since 5 ETH will go to the relayer. So <code>publicAmount = -15 ETH = -10 ETH - 5 ETH = extAmount - fee</code>.</li>
</ol>
<h3 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/tornadocash/tornado-pool">https://github.com/tornadocash/tornado-pool</a></p>
<p><a href="https://en.wikipedia.org/wiki/Unspent_transaction_output">https://en.wikipedia.org/wiki/Unspent_transaction_output</a></p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../../../mixer-protocols/tornado/contracts/NativeAnchor/" class="md-footer__link md-footer__link--prev" aria-label="Previous: NativeAnchor" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              NativeAnchor
            </div>
          </div>
        </a>
      
      
        
        <a href="../../../relayer/overview/" class="md-footer__link md-footer__link--next" aria-label="Next: Overview" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Overview
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.fcfe8b6d.min.js", "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.b1047164.min.js"></script>
      
    
  </body>
</html>