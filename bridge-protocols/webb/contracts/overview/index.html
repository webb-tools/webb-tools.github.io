
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://docs.webb.tools/bridge-protocols/webb/contracts/overview/">
      
      <link rel="icon" href="../../../../img/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.6">
    
    
      
        <title>Overview - Webb Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.a57b2b03.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#ffffff">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="white" data-md-color-accent="blue">
  
    
    <script>function __prefix(e){return new URL("../../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#protocol-solidity-documentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Webb Docs" class="md-header__button md-logo" aria-label="Webb Docs" data-md-component="logo">
      
  <img src="../../../../img/webb-icon.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Webb Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Overview
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Webb Docs" class="md-nav__button md-logo" aria-label="Webb Docs" data-md-component="logo">
      
  <img src="../../../../img/webb-icon.svg" alt="logo">

    </a>
    Webb Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Bridge protocols
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Bridge protocols" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Bridge protocols
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1">
          Webb Protocol
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Webb Protocol" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          Webb Protocol
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../technical-roadmap/" class="md-nav__link">
        Technical Roadmap
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../governance/" class="md-nav__link">
        Governance
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1_5" type="checkbox" id="__nav_2_1_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1_5">
          Implementations
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Implementations" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_1_5">
          <span class="md-nav__icon md-icon"></span>
          Implementations
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1_5_1" type="checkbox" id="__nav_2_1_5_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1_5_1">
          Solidity
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Solidity" data-md-level="4">
        <label class="md-nav__title" for="__nav_2_1_5_1">
          <span class="md-nav__icon md-icon"></span>
          Solidity
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Overview
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Overview
      </a>
      
        


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#depositing" class="md-nav__link">
    Depositing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basics-of-zero-knowledge-proofs" class="md-nav__link">
    Basics of Zero-Knowledge Proofs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#withdrawing-without-taking-privacy" class="md-nav__link">
    Withdrawing without Taking Privacy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-zero-knowledge-proofs-for-withdrawals" class="md-nav__link">
    Using Zero-Knowledge Proofs for Withdrawals
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#refund" class="md-nav__link">
    Refund
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preventing-double-spending" class="md-nav__link">
    Preventing Double Spending
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#refresh-commitment" class="md-nav__link">
    Refresh Commitment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1_5_1_2" type="checkbox" id="__nav_2_1_5_1_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1_5_1_2">
          Contracts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Contracts" data-md-level="5">
        <label class="md-nav__title" for="__nav_2_1_5_1_2">
          <span class="md-nav__icon md-icon"></span>
          Contracts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Anchor/" class="md-nav__link">
        Anchor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../AnchorBase/" class="md-nav__link">
        AnchorBase
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../LinkableAnchor/" class="md-nav__link">
        LinkableAnchor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../MerkleTreeWithHistoryPoseidon/" class="md-nav__link">
        MerkleTreeWithHistoryPoseidon
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1_5_2" type="checkbox" id="__nav_2_1_5_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1_5_2">
          Substrate
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Substrate" data-md-level="4">
        <label class="md-nav__title" for="__nav_2_1_5_2">
          <span class="md-nav__icon md-icon"></span>
          Substrate
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../pallets/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../pallets/overview/" class="md-nav__link">
        Pallets
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../deployments/" class="md-nav__link">
        Deployments
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Mixer protocols
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Mixer protocols" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Mixer protocols
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1">
          Tornado Core (webb version)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tornado Core (webb version)" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Tornado Core (webb version)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mixer-protocols/tornado/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mixer-protocols/tornado/deployments/" class="md-nav__link">
        Deployments
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_3" type="checkbox" id="__nav_3_1_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1_3">
          Contracts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Contracts" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_1_3">
          <span class="md-nav__icon md-icon"></span>
          Contracts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mixer-protocols/tornado/contracts/Anchor/" class="md-nav__link">
        Anchor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mixer-protocols/tornado/contracts/IHasher/" class="md-nav__link">
        IHasher
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mixer-protocols/tornado/contracts/IVerifier/" class="md-nav__link">
        IVerifier
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mixer-protocols/tornado/contracts/MerkleTreeWithHistory/" class="md-nav__link">
        MerkleTreeWithHistory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mixer-protocols/tornado/contracts/NativeAnchor/" class="md-nav__link">
        NativeAnchor
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Shielded Pool protocols
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Shielded Pool protocols" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Shielded Pool protocols
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1" type="checkbox" id="__nav_4_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_1">
          Tornado Pool
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tornado Pool" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          Tornado Pool
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../shielded-pool-protocols/tornado-pool/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Relayer
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Relayer" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Relayer
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../relayer/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../relayer/setup/" class="md-nav__link">
        Setup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../relayer/http-endpoints/" class="md-nav__link">
        Http Endpoints
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../relayer/websockets/" class="md-nav__link">
        WebSockets
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../repos/overview/" class="md-nav__link">
        Organisation Repos
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#depositing" class="md-nav__link">
    Depositing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basics-of-zero-knowledge-proofs" class="md-nav__link">
    Basics of Zero-Knowledge Proofs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#withdrawing-without-taking-privacy" class="md-nav__link">
    Withdrawing without Taking Privacy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-zero-knowledge-proofs-for-withdrawals" class="md-nav__link">
    Using Zero-Knowledge Proofs for Withdrawals
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#refund" class="md-nav__link">
    Refund
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preventing-double-spending" class="md-nav__link">
    Preventing Double Spending
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#refresh-commitment" class="md-nav__link">
    Refresh Commitment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="protocol-solidity-documentation">Protocol-Solidity Documentation<a class="headerlink" href="#protocol-solidity-documentation" title="Permanent link">&para;</a></h1>
<p>Suppose Alice wants to deposit on chain 1 and later wants to withdraw on chain 2.</p>
<h3 id="depositing">Depositing<a class="headerlink" href="#depositing" title="Permanent link">&para;</a></h3>
<ol>
<li>She deposits funds and a commitment (<code>hash(destinationChainID, nullifier, secret)</code>) from her account on chain 1 to the anchor (a smart contract) on chain 1.<ol>
<li>The form of the commitment means that Alice must pre-commit to which chain she will withdraw or refresh (more on this later) on, in this case, chain 2.</li>
</ol>
</li>
<li>The anchor on chain 1 adds Alice's commitment to its Merkle Tree. This emits an <code>event Deposit(_commitment, insertedIndex, block.timestamp)</code>.</li>
<li>A relayer picks up this event and opens a proposal to update (or add, if an edge does not already exist) Anchor 2's edge to Anchor 1. Anchor 2 stores a cache of Anchor 1's last 30 historical Merkle roots. If the proposal succeeds, Anchor 1's Merkle root will be added to this cache.</li>
<li>This proposal is then voted on by the relayers.<ol>
<li>This begs the question, why do we have to vote. This is because relayers may choose to submit bogus proposals (of deposits that never happened) or ignore some deposits or do other malicious activities...</li>
</ol>
</li>
<li>If the proposal passes, then <code>executeProposal</code> happens. The <code>AnchorHandler</code> then updates Anchor 2's edge to Anchor 1.</li>
<li>At this point Anchor 2 is "aware" of Alice's deposit into Anchor 1. By this we mean Alice can now submit a valid zero-knowledge proof to withdraw into chain 2 (more on this in the sections below).</li>
</ol>
<h3 id="basics-of-zero-knowledge-proofs">Basics of Zero-Knowledge Proofs<a class="headerlink" href="#basics-of-zero-knowledge-proofs" title="Permanent link">&para;</a></h3>
<ul>
<li>Suppose we have an arithmetic circuit.</li>
<li>A <strong>satisfying assignment</strong> to the circuit consists of inputs such that all the constraints of the circuit are satisfied.</li>
<li>A <strong>proof of a satisfying assignment</strong> for the circuit is a proof that we know some satisfying assignment to the circuit (note the most obvious way to do this is to just provide a satisfying assignment).</li>
<li>Now, lets call some of the inputs to the circuit as public and some as private. A <strong>zero-knowledge proof of a satisfying assignment</strong> for the circuit is a proof that we know some satisfying assignment to the circuit without revealing any information about the private inputs.</li>
</ul>
<h3 id="withdrawing-without-taking-privacy">Withdrawing without Taking Privacy<a class="headerlink" href="#withdrawing-without-taking-privacy" title="Permanent link">&para;</a></h3>
<p>An action which <strong>takes</strong> <strong>privacy</strong> is any action that provides information about private data.</p>
<p>Alice wishes to withdraw in a way which takes the least amount of privacy possible. </p>
<p>Recall that each anchor stores a cache of the last 30 historical Merkle roots of each anchor it has an edge to. To withdraw on chain 2, Alice must prove to the anchor 2 that her deposit commitment is a leaf on a Merkle tree with root in one of these caches. We call such a proof a <strong>one-of-many Merkle proof</strong>.  </p>
<p>Let's look at a naive approach that Alice can take to achieve this.</p>
<ol>
<li>Alice sends her <code>secret</code> and <code>nullifier</code> from her address on chain 2 to the anchor on chain 2. She also sends a one-of-many Merkle proof that <code>Poseidon(destinationChainID = 2, nullifier, secret)</code>  is a leaf in a Merkle tree with root in one of the caches maintained by anchor 2.    </li>
<li>The anchor on chain 2 can then verify the one-of-many Merkle proof and release funds to Alice's account on chain 2. </li>
</ol>
<p>Let's now understand where privacy is being taken in this approach. </p>
<p>When Alice deposited, she submitted funds along with a commitment to the anchor on chain 1. This data is available to the public. Now, if she publicly reveals her <code>secret</code> and <code>nullifier</code> when she withdraws on chain 2, anyone can can calculate <code>Poseidon(destinationChainID = 2, nullifier, secret)</code> and see that it equals her deposit commitment on chain 1. At this point everyone knows that Alice's accounts on chain 1 and chain 2 are controlled by the same person. If someone knows Alice's address on chain 1, then they also know it on chain 2. Thus, Alice's transfer of funds from chain 1 to chain 2 takes a large amount of privacy if she reveals the <code>secret</code> and <code>nullifier</code>. </p>
<p>So our <strong>first desiderata</strong> is that Alice should be able to withdraw without revealing her <code>secret</code> and <code>nullifier</code>.  In a similar vein, sending a one-of-many Merkle proof also requires Alice to reveal her deposit commitment, which in turn takes her privacy. So our <strong>second desiderata</strong> is that Alice should be able to withdraw without revealing the one-of-many Merkle proof.</p>
<p>In the next section, we show how Alice can achieve these two desiderata using <strong>zero-knowledge proofs</strong>. </p>
<p>There is one last thing to consider. If Alice sends the withdrawal proof to chain 2's anchor from her own account, anyone who knows Alice's address on chain 2, knows that it is her executing the withdrawal. To make this process more private, Alice can instead send the proof to a relayer which then submits the proof to anchor. The relayer sets the <code>recipient</code>  of the withdrawal funds to be a fresh new account, which Alice controls. This improves Alice's privacy since noone can link her to the fresh new account.</p>
<p>So our <strong>third desiderata</strong> is that Alice should withdraw using a <strong>relayer</strong>.</p>
<h3 id="using-zero-knowledge-proofs-for-withdrawals">Using Zero-Knowledge Proofs for Withdrawals<a class="headerlink" href="#using-zero-knowledge-proofs-for-withdrawals" title="Permanent link">&para;</a></h3>
<p>We describe a <code>Withdraw</code> circuit such that the constrainsts of these circuits are satisfied if and only if Alice can validly withdraw on chain 2. The <code>Withdraw</code> circuit contains two paramters <code>length</code> and <code>levels</code> . <code>length</code> is the number of anchors connected via an edge across the bridge.  <code>levels</code> is the height of the anchor Merkle trees. </p>
<p>The private inputs to the circuit are:</p>
<ol>
<li><code>secret</code></li>
<li><code>nullifier</code></li>
<li><code>pathElements[levels]</code> , an array of the Merkle proof elements. </li>
<li><code>pathIndices[levels]</code> , a binary array that indicates whether the corresponding <code>pathElement</code> element is on the left or right side of the Merkle tree. </li>
<li><code>diffs[length]</code>, an artifact of the <code>SetMembership</code> gadget that we describe below. </li>
</ol>
<p>The public inputs to the circuit are:</p>
<ol>
<li><code>nullifierHash</code>, which equals <code>Poseidon(nullifier, nullifier)</code>. Its use is described in a section below.</li>
<li><code>recipient</code>, the address of the recipient (not used in computation).</li>
<li><code>relayer</code>, the address of the relayer (not used in computation).</li>
<li><code>fee</code>, the fee paid by Alice to the relayer (not used in computation).</li>
<li><code>refund</code> described in a section below (not used in any computation)</li>
<li><code>refreshCommitment</code>described in a section below (not used in any computation)</li>
<li><code>chainID</code>, the destination chain ID, or in our case 2. </li>
<li><code>roots[length]</code> the set of roots Alice's is proving membership in.</li>
</ol>
<p>The <code>Withdraw</code> circuit is actually the composition of smaller gadget circuits:</p>
<ol>
<li>The <code>CommitmentHasher</code> circuit takes in the <code>secret</code> and <code>nullifier</code> and computes the <code>commitment</code> and the <code>nullifierHash</code>. <code>Withdraw</code> then checks that the computed <code>nullifierHash</code> is equal to the public input <code>nulliferHash</code>. This check is needed because otherwise, Alice can submit a bogus <code>nullifierHash</code> and double spend (more on this in a later section).</li>
<li>The <code>SetMembership</code> gadget takes in an <code>element</code> and a <code>set</code> and checks whether that <code>element</code> is in the <code>set</code>. Actually, <code>SetMembership</code> also takes in <code>diffs[length]</code> but we will explain more about this later.</li>
<li>The <code>ManyMerkleTreeChecker</code> gadget is responsible for checking the one-of-many Merkle proof. It takes in the <code>commitment</code>, <code>pathElements[levels]</code>, <code>pathIndices[levels]</code> and computes the root of the Merkle tree corresponding to these inputs. It also takes in <code>roots[length]</code>and uses the <code>SetMembership</code> gadget to check whether the computed Merkle root (from the previous sentence) is in <code>roots[length]</code>.</li>
</ol>
<p>We describe the individual gadgets in more detail in the pages below: </p>
<p><a href="../../circuits/DualMux/">DualMux</a></p>
<p><a href="../../circuits/CommitmentHasher/">CommitmentHasher</a></p>
<p><a href="../../circuits/SetMembership/">SetMembership</a></p>
<p><a href="../../circuits/ManyMerkleTreeChecker/">ManyMerkleTreeChecker</a></p>
<h3 id="refund">Refund<a class="headerlink" href="#refund" title="Permanent link">&para;</a></h3>
<p>Suppose a relayer submits a correct proof to an anchor on chain 2 and funds are withdrawn into a <strong>fresh new account</strong> for Alice. Suppose these funds are non-native tokens. Then, Alice cannot spend these tokens since she cannot pay the gas fees for transactions. </p>
<p>A way around this is for Alice to pay the relayer an amount equal to <code>fee + refund</code> and have the relayer deposit an amount equal to <code>refund</code> into the fresh account. </p>
<h3 id="preventing-double-spending">Preventing Double Spending<a class="headerlink" href="#preventing-double-spending" title="Permanent link">&para;</a></h3>
<p>How do we prevent Alice from double spending her deposit. We split our discussion into to cases:</p>
<p><em>Case 1: Double spending the same deposit on the same chain:</em> This is impossible due to the <code>nullifierHash</code>. When Alice withdraws on chain 2 the <code>nullifierHash = Poseidon(nullifier, nullifier)</code> is stored by the anchor. When she tries to withdraw with the same commitment the anchor will check its set of stored <code>nullifierHash</code>es and will realize she is trying to double spend. </p>
<p><em>Case 2: Double spending the same deposit on different chains:</em>  This is impossible because the commitment contains the destination chain. Therefore, if Alice tries to withdraw a commitment with destination chain ID equal to 2 on chain 3, the verifier will reject Alice's proof.  </p>
<h3 id="refresh-commitment">Refresh Commitment<a class="headerlink" href="#refresh-commitment" title="Permanent link">&para;</a></h3>
<p>Recall that Alice must commit to her destination chain when she deposits. Suppose Alice wants to change her destination chain from chain 2 to chain 3. She would have to withdraw on chain 2 and then redeposit into the anchor on chain 2 with her destination chain set to chain 3. </p>
<p>A refresh commitment allows these two steps to be combined into one function call. It allows Alice to add a commitment to the Merkle tree on anchor 2 with the destination chain set to chain 3, while simultaneously guaranteeing that she can no longer withdraw her original deposit. </p>
<p>The <code>refreshCommitment</code> signal in the <code>Withdraw</code> circuit is set to this new commitment if a refresh commitment is being done. If a traditional withdrawal is being made, the <code>refreshCommitment</code> signal is set to 0.</p>
<h3 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/tornadocash/tornado-core/blob/master/circuits/withdraw.circom">https://github.com/tornadocash/tornado-core/blob/master/circuits/withdraw.circom</a></p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../../governance/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Governance" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Governance
            </div>
          </div>
        </a>
      
      
        
        <a href="../Anchor/" class="md-footer__link md-footer__link--next" aria-label="Next: Anchor" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Anchor
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../../assets/javascripts/workers/search.fcfe8b6d.min.js", "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.b1047164.min.js"></script>
      
    
  </body>
</html>